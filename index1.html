<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CatWar Downloader</title>
    <style>
        /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ, –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞ –Ω–µ –¥—É–±–ª–∏—Ä—É—é */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #2c3e50, #34495e); color: white; padding: 25px; text-align: center; }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 16px; }
        .content { padding: 25px; }
        .tab-buttons { display: flex; margin-bottom: 20px; background: #f8f9fa; border-radius: 10px; padding: 5px; }
        .tab-button { flex: 1; padding: 12px; border: none; background: none; cursor: pointer; border-radius: 8px; font-weight: 600; transition: all 0.3s ease; }
        .tab-button.active { background: #3498db; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50; }
        textarea, input, select { width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; transition: border-color 0.3s ease; }
        textarea { height: 150px; resize: vertical; font-family: monospace; }
        textarea:focus, input:focus, select:focus { outline: none; border-color: #3498db; }
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px; }
        .checkbox-item { display: flex; align-items: center; gap: 8px; }
        .settings-row { display: flex; gap: 15px; margin-bottom: 15px; }
        .settings-row > div { flex: 1; }
        .btn { background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; padding: 15px 25px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s ease; width: 100%; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4); }
        .btn:disabled { background: #bdc3c7; cursor: not-allowed; transform: none; box-shadow: none; }
        .btn-success { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .btn-danger { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .btn-warning { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .progress-container { margin-top: 25px; background: #f8f9fa; border-radius: 10px; padding: 20px; display: none; }
        .progress-header { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .progress-bar { height: 10px; background: #e9ecef; border-radius: 5px; overflow: hidden; margin-bottom: 15px; }
        .progress-fill { height: 100%; background: linear-gradient(135deg, #2ecc71, #27ae60); width: 0%; transition: width 0.3s ease; }
        .log { height: 200px; background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 8px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 12px; margin-top: 15px; }
        .log-entry { margin-bottom: 5px; padding: 3px 0; line-height: 1.4; }
        .log-success { color: #2ecc71; }
        .log-error { color: #e74c3c; }
        .log-warning { color: #f39c12; }
        .log-info { color: #3498db; }
        .log-proxy { color: #9b59b6; }
        .log-check { color: #f1c40f; }
        .log-folder { color: #1abc9c; }
        .info-box { background: #e8f4fd; border: 1px solid #3498db; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
        .proxy-info { background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
        .folder-info { background: #d5f4e6; border: 1px solid #2ecc71; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
        .verification-info { background: #e8f6f3; border: 1px solid #1abc9c; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
        .feature-list { list-style: none; margin-top: 10px; }
        .feature-list li { padding: 5px 0; display: flex; align-items: center; gap: 10px; }
        .feature-list li::before { content: "‚úÖ"; }
        .preset-buttons { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
        .preset-btn { padding: 10px; border: 2px solid #3498db; background: white; color: #3498db; border-radius: 6px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; }
        .preset-btn:hover { background: #3498db; color: white; }
        .proxy-status { background: #e8f4fd; border: 1px solid #3498db; border-radius: 8px; padding: 10px; margin-bottom: 15px; font-size: 14px; }
        .folder-status { background: #d5f4e6; border: 1px solid #2ecc71; border-radius: 8px; padding: 10px; margin-bottom: 15px; font-size: 14px; }
        .verification-status { background: #e8f6f3; border: 1px solid #1abc9c; border-radius: 8px; padding: 10px; margin-bottom: 15px; font-size: 14px; }
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; }
        .stat-card { background: white; border: 1px solid #e1e5e9; border-radius: 8px; padding: 10px; text-align: center; }
        .stat-value { font-size: 18px; font-weight: bold; color: #2c3e50; }
        .stat-label { font-size: 12px; color: #7f8c8d; }
        .success-rate { color: #27ae60; }
        .error-rate { color: #e74c3c; }
        .check-rate { color: #f39c12; }
        .quick-actions { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .quick-btn { padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; text-align: center; transition: all 0.3s ease; }
        .costume-btn { background: #3498db; color: white; }
        .odor-btn { background: #9b59b6; color: white; }
        .medal-btn { background: #f1c40f; color: white; }
        .item-btn { background: #e67e22; color: white; }
        .quick-btn:hover { transform: translateY(-2px); opacity: 0.9; }
        .phase-indicator { display: flex; justify-content: center; gap: 10px; margin: 15px 0; }
        .phase { padding: 5px 10px; border-radius: 15px; font-size: 12px; background: #e9ecef; color: #6c757d; }
        .phase.active { background: #3498db; color: white; }
        .folder-structure { background: #2c3e50; color: white; padding: 10px; border-radius: 5px; margin: 10px 0; font-family: monospace; font-size: 11px; }
        .verification-settings { background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üê± CatWar Downloader</h1>
            <p>–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å CatWar —á–µ—Ä–µ–∑ CORS –ø—Ä–æ–∫—Å–∏</p>
        </div>
        
        <div class="content">
            <div class="info-box">
                <strong>üìù –û –ø—Ä–æ–≥—Ä–∞–º–º–µ:</strong>
                <p>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å CatWar. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç CORS –ø—Ä–æ–∫—Å–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –±—Ä–∞—É–∑–µ—Ä–∞.</p>
            </div>
            
            <div class="proxy-info">
                <strong>üåê –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–∫—Å–∏:</strong>
                <p>–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ CORS –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä—ã –¥–ª—è –æ–±—Ö–æ–¥–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –±—Ä–∞—É–∑–µ—Ä–∞. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –ø—Ä–æ–∫—Å–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.</p>
            </div>

            <div class="folder-info">
                <strong>üìÅ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤:</strong>
                <p>–í—Å–µ —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–∞–ø–∫—É "CatWar_Downloads" —Å –ø–æ–¥–ø–∞–ø–∫–∞–º–∏ –ø–æ —Ç–∏–ø–∞–º –∫–æ–Ω—Ç–µ–Ω—Ç–∞. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
            </div>

            <div class="verification-info">
                <strong>üîç –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤:</strong>
                <p>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —â–∞–¥—è—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ HTTP —Å—Ç–∞—Ç—É—Å—ã. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 1 –±–∞–π—Ç. –ë–µ–∑ —Å—Ç—Ä–æ–≥–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ MIME-type.</p>
            </div>
            
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('bbcode')">üìù BB-–∫–æ–¥—ã</button>
                <button class="tab-button" onclick="switchTab('generator')">üéØ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</button>
                <button class="tab-button" onclick="switchTab('mass')">üöÄ –ú–∞—Å—Å–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞</button>
                <button class="tab-button" onclick="switchTab('quick')">‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</button>
            </div>
            
            <!-- TAB 1: BB-CODE -->
            <div id="bbcode" class="tab-content active">
                <div class="form-group">
                    <label>–í—Å—Ç–∞–≤—å—Ç–µ BB-–∫–æ–¥—ã —Å [img]—Å—Å—ã–ª–∫–∞–º–∏[/img]:</label>
                    <textarea id="bbcodeInput" placeholder="[img]https://catwar.net/cw3/cats/0/costume/1.png[/img]
[img]https://catwar.net/cw3/odoroj/1.png[/img]
[img]https://catwar.net/cw3/actions/1.png[/img]"></textarea>
                </div>
                
                <div class="settings-row">
                    <div>
                        <label>–ó–∞–¥–µ—Ä–∂–∫–∞ (–º—Å):</label>
                        <input type="number" id="delay1" value="800" min="500" max="3000">
                    </div>
                    <div>
                        <label>–õ–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:</label>
                        <input type="number" id="limit1" value="20" min="1" max="30">
                    </div>
                </div>

                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:</label>
                    <input type="text" id="folderName" value="CatWar_Downloads" placeholder="–ò–º—è –ø–∞–ø–∫–∏">
                </div>

                <div class="verification-settings">
                    <strong>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:</strong>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" id="strictVerification" checked> –°—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="skipHeadRequests"> –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å HEAD –∑–∞–ø—Ä–æ—Å—ã (–µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã)
                        </label>
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="parseAndDownloadBBCode()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ —Å–∫–∞—á–∞—Ç—å</button>
            </div>
            
            <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º–∏, –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞ –Ω–µ –¥—É–±–ª–∏—Ä—É—é -->
            
            <!-- PROGRESS SECTION -->
            <div class="progress-container" id="progressContainer">
                <div class="phase-indicator">
                    <div class="phase" id="phaseCheck">üîç –ü—Ä–æ–≤–µ—Ä–∫–∞</div>
                    <div class="phase" id="phaseDownload">üì• –°–∫–∞—á–∏–≤–∞–Ω–∏–µ</div>
                </div>
                
                <div class="proxy-status" id="proxyStatus">
                    <strong>üåê –¢–µ–∫—É—â–∏–π –ø—Ä–æ–∫—Å–∏:</strong> <span id="currentProxy">corsproxy.io</span>
                    <strong>üìä –°—Ç–∞—Ç—É—Å:</strong> <span id="currentPhase">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤...</span>
                </div>

                <div class="folder-status" id="folderStatus">
                    <strong>üìÅ –ü–∞–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:</strong> <span id="currentFolder">CatWar_Downloads/</span>
                    <strong>üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞:</strong> <span id="folderStructure">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è</span>
                </div>

                <div class="verification-status" id="verificationStatus">
                    <strong>üîç –†–µ–∂–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∏:</strong> <span id="verificationMode">–©–∞–¥—è—â–∏–π</span>
                    <strong>üìè –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä:</strong> <span id="minSize">1 –±–∞–π—Ç</span>
                </div>
                
                <div class="progress-header">
                    <div>
                        <strong>–ü—Ä–æ–≥—Ä–µ—Å—Å:</strong> <span id="statusText">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...</span>
                    </div>
                    <div>
                        <span id="progressText">0/0</span>
                    </div>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value check-rate" id="checkedCount">0</div>
                        <div class="stat-label">–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value success-rate" id="validCount">0</div>
                        <div class="stat-label">–í–∞–ª–∏–¥–Ω—ã–µ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value error-rate" id="invalidCount">0</div>
                        <div class="stat-label">–ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value success-rate" id="downloadedCount">0</div>
                        <div class="stat-label">–°–∫–∞—á–∞–Ω–æ</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="btn btn-danger" onclick="stopDownload()" id="stopBtn" disabled>‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                    <button class="btn btn-warning" onclick="skipCurrent()" id="skipBtn" disabled>‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
                </div>
                
                <div class="log" id="logContainer"></div>
            </div>
        </div>
    </div>

    <script>
        // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
        const CORS_PROXIES = [
            'https://corsproxy.io/?',
            'https://api.codetabs.com/v1/proxy?quest=',
            'https://cors-anywhere.herokuapp.com/'
        ];

        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let allUrls = [];
        let validUrls = [];
        let downloadQueue = [];
        let isChecking = false;
        let isDownloading = false;
        let currentIndex = 0;
        let totalFiles = 0;
        let currentProxyIndex = 0;
        let checkedCount = 0;
        let validCount = 0;
        let invalidCount = 0;
        let downloadedCount = 0;
        let abortController = null;
        let currentFolderName = "CatWar_Downloads";
        let useStrictVerification = true;
        let skipHeadRequests = false;

        // ==================== –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô ====================
        async function checkImageExists(url) {
            for (let attempt = 1; attempt <= 2; attempt++) {
                try {
                    const proxyUrl = getProxyUrl(url);
                    
                    // üîÑ –£–õ–£–ß–®–ï–ù–ò–ï 1: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π HEAD –∑–∞–ø—Ä–æ—Å
                    if (useStrictVerification && !skipHeadRequests && attempt === 1) {
                        try {
                            const headResponse = await fetch(proxyUrl, {
                                method: 'HEAD',
                                signal: abortController?.signal,
                                headers: {
                                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
                                }
                            });

                            if (!headResponse.ok) {
                                // üõ†Ô∏è –£–õ–£–ß–®–ï–ù–ò–ï 2: –ù–µ –≤—Å–µ –∫–æ–¥—ã –æ—à–∏–±–æ–∫ —Ñ–∞—Ç–∞–ª—å–Ω—ã
                                if (headResponse.status === 404) {
                                    throw new Error('–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω (404)');
                                } else if (headResponse.status >= 500) {
                                    throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${headResponse.status}`);
                                } else {
                                    throw new Error(`HTTP ${headResponse.status}`);
                                }
                            }

                            // üõ†Ô∏è –£–õ–£–ß–®–ï–ù–ò–ï 3: –ú—è–≥–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ Content-Type
                            const contentType = headResponse.headers.get('content-type');
                            if (contentType) {
                                const isImage = contentType.startsWith('image/') || 
                                              contentType.includes('octet-stream') ||
                                              contentType.includes('application/');
                                if (!isImage) {
                                    addLog(`‚ö†Ô∏è –ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Content-Type: ${contentType}`, 'warning');
                                    // –ù–µ –±—Ä–æ—Å–∞–µ–º –æ—à–∏–±–∫—É, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
                                }
                            }

                            // üõ†Ô∏è –£–õ–£–ß–®–ï–ù–ò–ï 4: –£–±—Ä–∞–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞
                            const contentLength = headResponse.headers.get('content-length');
                            if (contentLength && parseInt(contentLength) === 0) {
                                throw new Error('–§–∞–π–ª –ø—É—Å—Ç–æ–π (0 –±–∞–π—Ç)');
                            }

                        } catch (headError) {
                            // HEAD –∑–∞–ø—Ä–æ—Å –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å GET
                            if (headError.name !== 'AbortError') {
                                addLog(`‚ö†Ô∏è HEAD –∑–∞–ø—Ä–æ—Å –ø—Ä–æ–ø—É—â–µ–Ω: ${headError.message}`, 'warning');
                            }
                        }
                    }
                    
                    // üõ†Ô∏è –£–õ–£–ß–®–ï–ù–ò–ï 5: –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ GET –±–µ–∑ Range
                    const getResponse = await fetch(proxyUrl, {
                        signal: abortController?.signal,
                        headers: {
                            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
                            // –£–±—Ä–∞–ª–∏ Range header - –æ–Ω –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
                        }
                    });

                    // üõ†Ô∏è –£–õ–£–ß–®–ï–ù–ò–ï 6: –ë–æ–ª–µ–µ –≥–∏–±–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ HTTP —Å—Ç–∞—Ç—É—Å–æ–≤
                    if (!getResponse.ok) {
                        if (getResponse.status === 404) {
                            throw new Error('–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω (404)');
                        } else if (getResponse.status === 403) {
                            throw new Error('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω (403)');
                        } else if (getResponse.status >= 500) {
                            throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${getResponse.status}`);
                        } else {
                            throw new Error(`HTTP ${getResponse.status}`);
                        }
                    }

                    // üõ†Ô∏è –£–õ–£–ß–®–ï–ù–ò–ï 7: –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–±–æ–ª—å—à—É—é —á–∞—Å—Ç—å —Ñ–∞–π–ª–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
                    const blob = await getResponse.blob();
                    
                    // üõ†Ô∏è –£–õ–£–ß–®–ï–ù–ò–ï 8: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≤—Å–µ–≥–æ 1 –±–∞–π—Ç
                    if (blob.size === 0) {
                        throw new Error('–§–∞–π–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—É—Å—Ç–æ–π');
                    }

                    // üõ†Ô∏è –£–õ–£–ß–®–ï–ù–ò–ï 9: –£–±—Ä–∞–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ MIME-type
                    // –ü—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–∏–ø—ã, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º
                    if (blob.type && !blob.type.startsWith('image/')) {
                        addLog(`‚ö†Ô∏è –ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π MIME-type: ${blob.type}`, 'warning');
                    }

                    return { 
                        exists: true, 
                        size: blob.size,
                        type: blob.type || 'unknown'
                    };

                } catch (error) {
                    if (error.name === 'AbortError') throw error;
                    
                    addLog(`‚ùå –ü–æ–ø—ã—Ç–∫–∞ ${attempt} –Ω–µ —É–¥–∞–ª–∞—Å—å: ${error.message}`, 'error');
                    
                    if (attempt < 2) {
                        rotateProxy();
                        await new Promise(resolve => setTimeout(resolve, 500));
                    } else {
                        return { exists: false, error: error.message };
                    }
                }
            }
            return { exists: false, error: '–í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å' };
        }

        // üõ†Ô∏è –£–õ–£–ß–®–ï–ù–ò–ï 10: –†–µ–∂–∏–º "—Å—É–ø–µ—Ä-—â–∞–¥—è—â–µ–π" –ø—Ä–æ–≤–µ—Ä–∫–∏ (—Ç–æ–ª—å–∫–æ HTTP —Å—Ç–∞—Ç—É—Å)
        async function lenientCheckImageExists(url) {
            try {
                const proxyUrl = getProxyUrl(url);
                
                const response = await fetch(proxyUrl, {
                    signal: abortController?.signal,
                    method: 'GET',
                    headers: {
                        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
                        'Range': 'bytes=0-0' // –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ 1 –±–∞–π—Ç –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
                    }
                });

                // üéØ –°–ê–ú–ê–Ø –ú–Ø–ì–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê: —Ç–æ–ª—å–∫–æ HTTP —Å—Ç–∞—Ç—É—Å 200
                if (response.status === 200) {
                    return { exists: true, size: 0, type: 'assumed_image' };
                } else if (response.status === 404) {
                    return { exists: false, error: '–ù–µ –Ω–∞–π–¥–µ–Ω–æ (404)' };
                } else {
                    return { exists: false, error: `HTTP ${response.status}` };
                }

            } catch (error) {
                return { exists: false, error: error.message };
            }
        }

        // ==================== –û–ë–ù–û–í–õ–ï–ù–ù–´–ô –ü–†–û–¶–ï–°–° –ü–†–û–í–ï–†–ö–ò ====================
        async function processCheckQueue(urls, delay) {
            if (!isChecking || currentIndex >= urls.length) {
                if (currentIndex >= urls.length) {
                    finishCheckPhase();
                }
                return;
            }

            const url = urls[currentIndex];
            const filename = getFilenameFromUrl(url);

            const progress = ((currentIndex + 1) / totalFiles) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `${currentIndex + 1}/${totalFiles}`;
            document.getElementById('statusText').textContent = `–ü—Ä–æ–≤–µ—Ä–∫–∞: ${filename}`;

            try {
                addLog(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞: ${filename}`, 'check');
                
                // üõ†Ô∏è –£–õ–£–ß–®–ï–ù–ò–ï 11: –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
                let result;
                if (useStrictVerification) {
                    result = await checkImageExists(url);
                } else {
                    result = await lenientCheckImageExists(url);
                    addLog(`‚ö° –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: ${filename}`, 'info');
                }
                
                checkedCount++;
                
                if (result.exists) {
                    validUrls.push(url);
                    validCount++;
                    const sizeInfo = result.size > 0 ? ` (${formatFileSize(result.size)})` : '';
                    addLog(`‚úÖ –í–∞–ª–∏–¥–Ω—ã–π: ${filename}${sizeInfo}`, 'success');
                } else {
                    invalidCount++;
                    addLog(`‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π: ${filename} - ${result.error}`, 'error');
                }

            } catch (error) {
                if (error.name !== 'AbortError') {
                    checkedCount++;
                    invalidCount++;
                    addLog(`üí• –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ${filename} - ${error.message}`, 'error');
                }
            }

            updateStats();
            currentIndex++;

            if (currentIndex < urls.length && isChecking) {
                setTimeout(() => processCheckQueue(urls, delay), delay);
            } else {
                finishCheckPhase();
            }
        }

        // ==================== –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        function startCheckPhase(urls, delay) {
            allUrls = urls;
            validUrls = [];
            checkedCount = 0;
            validCount = 0;
            invalidCount = 0;
            downloadedCount = 0;
            currentIndex = 0;
            totalFiles = urls.length;
            currentProxyIndex = 0;
            isChecking = true;

            // üõ†Ô∏è –£–õ–£–ß–®–ï–ù–ò–ï 12: –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
            useStrictVerification = document.getElementById('strictVerification')?.checked ?? true;
            skipHeadRequests = document.getElementById('skipHeadRequests')?.checked ?? false;

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞–ø–∫–µ
            updateFolderInfo();
            updateVerificationInfo();

            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('progressText').textContent = `0/${totalFiles}`;
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('statusText').textContent = '–ù–∞—á–∞–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏...';
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('skipBtn').disabled = false;
            document.getElementById('currentProxy').textContent = 'corsproxy.io';
            document.getElementById('currentPhase').textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤';

            setPhase('check');
            updateStats();
            
            addLog(`üîç –ù–∞—á–∞–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏: ${totalFiles} —Ñ–∞–π–ª–æ–≤`, 'info');
            addLog(`üåê –ê–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–∫—Å–∏: corsproxy.io`, 'proxy');
            addLog(`üìÅ –ü–∞–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${currentFolderName}/`, 'folder');
            addLog(`üîß –†–µ–∂–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∏: ${useStrictVerification ? '–°—Ç—Ä–æ–≥–∏–π' : '–©–∞–¥—è—â–∏–π'}`, 'info');
            if (skipHeadRequests) addLog(`‚ö° –ü—Ä–æ–ø—É—Å–∫ HEAD –∑–∞–ø—Ä–æ—Å–æ–≤`, 'info');
            addLog(`‚è±Ô∏è –ó–∞–¥–µ—Ä–∂–∫–∞: ${delay}–º—Å`, 'info');

            processCheckQueue(urls, delay);
        }

        function updateVerificationInfo() {
            const mode = useStrictVerification ? '–°—Ç—Ä–æ–≥–∏–π' : '–©–∞–¥—è—â–∏–π';
            const minSize = useStrictVerification ? '1 –±–∞–π—Ç' : '—Ç–æ–ª—å–∫–æ HTTP —Å—Ç–∞—Ç—É—Å';
            
            document.getElementById('verificationMode').textContent = mode;
            document.getElementById('minSize').textContent = minSize;
        }

        // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò (–æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ====================
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function getProxyUrl(url) {
            return CORS_PROXIES[currentProxyIndex] + encodeURIComponent(url);
        }

        function rotateProxy() {
            currentProxyIndex = (currentProxyIndex + 1) % CORS_PROXIES.length;
            const proxyNames = ['corsproxy.io', 'codetabs.com', 'cors-anywhere'];
            document.getElementById('currentProxy').textContent = proxyNames[currentProxyIndex];
        }

        function updateStats() {
            document.getElementById('checkedCount').textContent = checkedCount;
            document.getElementById('validCount').textContent = validCount;
            document.getElementById('invalidCount').textContent = invalidCount;
            document.getElementById('downloadedCount').textContent = downloadedCount;
        }

        function setPhase(phase) {
            document.getElementById('phaseCheck').classList.remove('active');
            document.getElementById('phaseDownload').classList.remove('active');
            
            if (phase === 'check') {
                document.getElementById('phaseCheck').classList.add('active');
                document.getElementById('currentPhase').textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤';
            } else {
                document.getElementById('phaseDownload').classList.add('active');
                document.getElementById('currentPhase').textContent = '–°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤';
            }
        }

        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ...

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üîß CatWar Downloader –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'info');
            addLog('üîç –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞', 'check');
            addLog('üåê CORS Proxy: corsproxy.io, codetabs.com, cors-anywhere', 'proxy');
            addLog('üìÅ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –≤ –ø–∞–ø–∫–∏', 'folder');
            addLog('üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'info');
            addLog('‚ö° –°–æ–≤–µ—Ç: –ï—Å–ª–∏ —Ñ–∞–π–ª—ã –±—Ä–∞–∫—É—é—Ç—Å—è, –æ—Ç–∫–ª—é—á–∏—Ç–µ "–°—Ç—Ä–æ–≥—É—é –ø—Ä–æ–≤–µ—Ä–∫—É"', 'warning');
        });
    </script>
</body>
</html>
